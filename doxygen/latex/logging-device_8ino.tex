\hypertarget{logging-device_8ino}{}\section{logging-\/device/logging-\/device.ino File Reference}
\label{logging-device_8ino}\index{logging-\/device/logging-\/device.\+ino@{logging-\/device/logging-\/device.\+ino}}


Arduino sketch for the logging device.  


{\ttfamily \#include $<$Software\+Serial.\+h$>$}\newline
{\ttfamily \#include $<$Tiny\+G\+P\+S++.\+h$>$}\newline
{\ttfamily \#include $<$Arduino\+Json.\+h$>$}\newline
{\ttfamily \#include \char`\"{}Orientation.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Storage.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{logging-device_8ino_ad7f0721d7856c100a69be7fa82e2865b}\label{logging-device_8ino_ad7f0721d7856c100a69be7fa82e2865b}} 
\#define \hyperlink{logging-device_8ino_ad7f0721d7856c100a69be7fa82e2865b}{I\+D\+L\+E\+\_\+\+C\+H\+AR}~\textquotesingle{}0\textquotesingle{}
\begin{DoxyCompactList}\small\item\em Command to set system to idle mode. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_a911a5839eebf5e3d5927f4f77e9bfb62}\label{logging-device_8ino_a911a5839eebf5e3d5927f4f77e9bfb62}} 
\#define \hyperlink{logging-device_8ino_a911a5839eebf5e3d5927f4f77e9bfb62}{R\+E\+A\+L\+T\+I\+M\+E\+\_\+\+C\+H\+AR}~\textquotesingle{}1\textquotesingle{}
\begin{DoxyCompactList}\small\item\em Command to set system to realtime logging mode. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_a4ffb22b7b0017657087830d24f68a323}\label{logging-device_8ino_a4ffb22b7b0017657087830d24f68a323}} 
\#define \hyperlink{logging-device_8ino_a4ffb22b7b0017657087830d24f68a323}{L\+I\+S\+T\+\_\+\+S\+A\+V\+E\+D\+\_\+\+C\+H\+AR}~\textquotesingle{}2\textquotesingle{}
\begin{DoxyCompactList}\small\item\em Command to list all saved trip names from u\+SD. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_aa72e33a6bcfedf9118f573741b4e137b}\label{logging-device_8ino_aa72e33a6bcfedf9118f573741b4e137b}} 
\#define \hyperlink{logging-device_8ino_aa72e33a6bcfedf9118f573741b4e137b}{L\+O\+A\+D\+\_\+\+T\+R\+I\+P\+\_\+\+C\+H\+AR}~\textquotesingle{}3\textquotesingle{}
\begin{DoxyCompactList}\small\item\em Command to load a trip stored on u\+SD. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_ad1e6e6f6fc813b305067b9e1b0777ea6}\label{logging-device_8ino_ad1e6e6f6fc813b305067b9e1b0777ea6}} 
\#define \hyperlink{logging-device_8ino_ad1e6e6f6fc813b305067b9e1b0777ea6}{B\+T\+\_\+\+S\+E\+R\+I\+AL}~Serial1
\begin{DoxyCompactList}\small\item\em Mapping for which H\+W-\/\+Serial port BT module is on. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_a6882992121626898bccaa43be51ba4c2}\label{logging-device_8ino_a6882992121626898bccaa43be51ba4c2}} 
\#define \hyperlink{logging-device_8ino_a6882992121626898bccaa43be51ba4c2}{B\+T\+\_\+\+B\+A\+UD}~115200
\begin{DoxyCompactList}\small\item\em B\+A\+UD rate of BT device. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_acae14b9c1767cfec367a4b96009c94e5}\label{logging-device_8ino_acae14b9c1767cfec367a4b96009c94e5}} 
\#define \hyperlink{logging-device_8ino_acae14b9c1767cfec367a4b96009c94e5}{G\+P\+S\+\_\+\+T\+X\+\_\+\+P\+IN}~9
\begin{DoxyCompactList}\small\item\em G\+PS serial transmit pin. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_a6f8927970de9eedcbb8f6c14b1d0d6c3}\label{logging-device_8ino_a6f8927970de9eedcbb8f6c14b1d0d6c3}} 
\#define \hyperlink{logging-device_8ino_a6f8927970de9eedcbb8f6c14b1d0d6c3}{G\+P\+S\+\_\+\+R\+X\+\_\+\+P\+IN}~8
\begin{DoxyCompactList}\small\item\em G\+PS serial receive pin. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_af0875ffe69dbe45df3f85c1f720c3eee}\label{logging-device_8ino_af0875ffe69dbe45df3f85c1f720c3eee}} 
\#define \hyperlink{logging-device_8ino_af0875ffe69dbe45df3f85c1f720c3eee}{G\+P\+S\+\_\+\+B\+A\+UD}~9600
\begin{DoxyCompactList}\small\item\em G\+PS serial baud rate. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_ab4553be4db9860d940f81d7447173b2f}\label{logging-device_8ino_ab4553be4db9860d940f81d7447173b2f}} 
\#define \hyperlink{logging-device_8ino_ab4553be4db9860d940f81d7447173b2f}{L\+E\+D\+\_\+\+P\+IN}~13
\begin{DoxyCompactList}\small\item\em L\+ED pin to indicate read. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{logging-device_8ino_a980e950615d86dadef54f3cfaefb5fb4}\label{logging-device_8ino_a980e950615d86dadef54f3cfaefb5fb4}} 
enum \hyperlink{logging-device_8ino_a980e950615d86dadef54f3cfaefb5fb4}{O\+P\+E\+R\+A\+T\+I\+N\+G\+\_\+\+M\+O\+DE} \{ {\bfseries I\+D\+LE}, 
{\bfseries R\+E\+A\+L\+T\+I\+ME}
 \}\begin{DoxyCompactList}\small\item\em Typedef holding two possible states for device. \end{DoxyCompactList}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{logging-device_8ino_aa2475f51bdc0f31d16d2916991d618d9}\label{logging-device_8ino_aa2475f51bdc0f31d16d2916991d618d9}} 
Software\+Serial \hyperlink{logging-device_8ino_aa2475f51bdc0f31d16d2916991d618d9}{ser\+G\+PS} (\hyperlink{logging-device_8ino_a6f8927970de9eedcbb8f6c14b1d0d6c3}{G\+P\+S\+\_\+\+R\+X\+\_\+\+P\+IN}, \hyperlink{logging-device_8ino_acae14b9c1767cfec367a4b96009c94e5}{G\+P\+S\+\_\+\+T\+X\+\_\+\+P\+IN})
\begin{DoxyCompactList}\small\item\em Serial object for communicating with G\+PS module. \end{DoxyCompactList}\item 
void \hyperlink{logging-device_8ino_a4fc01d736fe50cf5b977f755b675f11d}{setup} ()
\begin{DoxyCompactList}\small\item\em Runs once at boot of arduino. \end{DoxyCompactList}\item 
void \hyperlink{logging-device_8ino_afe461d27b9c48d5921c00d521181f12f}{loop} ()
\begin{DoxyCompactList}\small\item\em Main system loop for arduino. \end{DoxyCompactList}\item 
bool \hyperlink{logging-device_8ino_aec1eb39e3cfde6331c4d29938c952c84}{parse\+New\+Mode} (char mode\+Char, \hyperlink{logging-device_8ino_a980e950615d86dadef54f3cfaefb5fb4}{O\+P\+E\+R\+A\+T\+I\+N\+G\+\_\+\+M\+O\+DE} \&new\+Mode)
\begin{DoxyCompactList}\small\item\em Returns whether system should change operating mode. \end{DoxyCompactList}\item 
void \hyperlink{logging-device_8ino_ab4c1c4c0fa047e336f9f4176406a54f1}{real\+Time\+Mode} ()
\begin{DoxyCompactList}\small\item\em Responsible for completing work needed in relatime mode. \end{DoxyCompactList}\item 
void \hyperlink{logging-device_8ino_a8d3614b16b26b9734d79e9f8f6695af3}{add\+Orientation\+To\+J\+S\+ON} ()
\begin{DoxyCompactList}\small\item\em Responsible for updating orientation J\+S\+ON object with newest information. \end{DoxyCompactList}\item 
void \hyperlink{logging-device_8ino_af1705fad6a6282b24379a174e18d4fe4}{add\+G\+P\+S\+To\+J\+S\+ON} ()
\begin{DoxyCompactList}\small\item\em Responsible for updating G\+PS J\+S\+ON object with newest information. \end{DoxyCompactList}\item 
void \hyperlink{logging-device_8ino_a9e4931f452cd25dfff67d41e7c9c0efb}{add\+Time\+To\+J\+S\+ON} ()
\begin{DoxyCompactList}\small\item\em Responsible for updating time J\+S\+ON object with newest information. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{logging-device_8ino_a13a2ecbcf455940dd240e54e9e39cf7a}\label{logging-device_8ino_a13a2ecbcf455940dd240e54e9e39cf7a}} 
\hyperlink{logging-device_8ino_a980e950615d86dadef54f3cfaefb5fb4}{O\+P\+E\+R\+A\+T\+I\+N\+G\+\_\+\+M\+O\+DE} \hyperlink{logging-device_8ino_a13a2ecbcf455940dd240e54e9e39cf7a}{system\+Mode} = I\+D\+LE
\begin{DoxyCompactList}\small\item\em State machine for system state of device. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_a47be0262307aa023a1bda3d98986a16d}\label{logging-device_8ino_a47be0262307aa023a1bda3d98986a16d}} 
\hyperlink{class_orientation}{Orientation} \hyperlink{logging-device_8ino_a47be0262307aa023a1bda3d98986a16d}{orientation}
\begin{DoxyCompactList}\small\item\em \hyperlink{class_orientation}{Orientation} object, used for receiving device orientation. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_a40059244119c00baa1b841119cfd1b2e}\label{logging-device_8ino_a40059244119c00baa1b841119cfd1b2e}} 
\hyperlink{class_storage}{Storage} \hyperlink{logging-device_8ino_a40059244119c00baa1b841119cfd1b2e}{storage}
\begin{DoxyCompactList}\small\item\em \hyperlink{class_storage}{Storage} object, responsible for saving \& loading from u\+SD. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}\label{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}} 
Tiny\+G\+P\+S\+Plus \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}
\begin{DoxyCompactList}\small\item\em Our G\+PS object, responsible for parsing N\+M\+EA codes. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_ae3799d2cbf8f13e21cbaef64b75c6833}\label{logging-device_8ino_ae3799d2cbf8f13e21cbaef64b75c6833}} 
Static\+Json\+Buffer$<$ 500 $>$ \hyperlink{logging-device_8ino_ae3799d2cbf8f13e21cbaef64b75c6833}{json\+Buffer}
\begin{DoxyCompactList}\small\item\em Allocated space for holding all J\+S\+ON objects within. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_a5eebfb3b76a83174d0f5d032d1f6bfb7}\label{logging-device_8ino_a5eebfb3b76a83174d0f5d032d1f6bfb7}} 
Json\+Object \& \hyperlink{logging-device_8ino_a5eebfb3b76a83174d0f5d032d1f6bfb7}{main\+J\+S\+ON} = json\+Buffer.\+create\+Object()
\begin{DoxyCompactList}\small\item\em Parent J\+S\+ON object, holds orientation, time \& gps children. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_ae8e95a76df2aaa373792e5b744a6bb73}\label{logging-device_8ino_ae8e95a76df2aaa373792e5b744a6bb73}} 
Json\+Object \& \hyperlink{logging-device_8ino_ae8e95a76df2aaa373792e5b744a6bb73}{orient\+J\+S\+ON} = main\+J\+S\+O\+N.\+create\+Nested\+Object(\char`\"{}orientation\char`\"{})
\begin{DoxyCompactList}\small\item\em Holds all orientation related information. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_a548727e041a5cd3db91bdbd0ccd71e30}\label{logging-device_8ino_a548727e041a5cd3db91bdbd0ccd71e30}} 
Json\+Object \& \hyperlink{logging-device_8ino_a548727e041a5cd3db91bdbd0ccd71e30}{gps\+J\+S\+ON} = main\+J\+S\+O\+N.\+create\+Nested\+Object(\char`\"{}gps\char`\"{})
\begin{DoxyCompactList}\small\item\em Holds all location related information. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_acc172a29cb5ff709b48b650d9fb6503c}\label{logging-device_8ino_acc172a29cb5ff709b48b650d9fb6503c}} 
Json\+Object \& \hyperlink{logging-device_8ino_acc172a29cb5ff709b48b650d9fb6503c}{time\+J\+S\+ON} = main\+J\+S\+O\+N.\+create\+Nested\+Object(\char`\"{}time\char`\"{})
\begin{DoxyCompactList}\small\item\em Holds all time related inforamtion. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Arduino sketch for the logging device. 

\begin{DoxyAuthor}{Author}
Jack Allister -\/ 23042098 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
2016-\/2017
\begin{DoxyItemize}
\item Arduino 101
\item Sparkfun G\+PS Logger shield
\item Onboard gyroscope + accelerometer
\item H\+C-\/06 Serial Bluetooth Module 
\end{DoxyItemize}
\end{DoxyDate}


\subsection{Function Documentation}
\mbox{\Hypertarget{logging-device_8ino_a4fc01d736fe50cf5b977f755b675f11d}\label{logging-device_8ino_a4fc01d736fe50cf5b977f755b675f11d}} 
\index{logging-\/device.\+ino@{logging-\/device.\+ino}!setup@{setup}}
\index{setup@{setup}!logging-\/device.\+ino@{logging-\/device.\+ino}}
\subsubsection{\texorpdfstring{setup()}{setup()}}
{\footnotesize\ttfamily void setup (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Runs once at boot of arduino. 

Responsible for setting up the peripherals. ~\newline
Initialises modules such as storage, bluetooth \& gps. 

References B\+T\+\_\+\+B\+A\+UD, B\+T\+\_\+\+S\+E\+R\+I\+AL, G\+P\+S\+\_\+\+B\+A\+UD, Storage\+::init(), Orientation\+::init(), L\+E\+D\+\_\+\+P\+IN, and ser\+G\+P\+S().


\begin{DoxyCode}
98 \{
99   pinMode(\hyperlink{logging-device_8ino_ab4553be4db9860d940f81d7447173b2f}{LED\_PIN}, OUTPUT);
100 
101   \textcolor{comment}{/* Initialise our created modules */}
102   \hyperlink{logging-device_8ino_a40059244119c00baa1b841119cfd1b2e}{storage}.\hyperlink{class_storage_a98b01eb20a64a4bf4127685147f7f6f1}{init}();
103   \hyperlink{logging-device_8ino_a47be0262307aa023a1bda3d98986a16d}{orientation}.\hyperlink{class_orientation_a317461c5c8afa8c3abf56847d4544728}{init}();
104 
105   \textcolor{comment}{/* Set up serial for wireless data transmission */}
106   \hyperlink{logging-device_8ino_ad1e6e6f6fc813b305067b9e1b0777ea6}{BT\_SERIAL}.begin(\hyperlink{logging-device_8ino_a6882992121626898bccaa43be51ba4c2}{BT\_BAUD});
107 
108   \textcolor{comment}{/* Set up serial for GPS module */}
109   \hyperlink{logging-device_8ino_aa2475f51bdc0f31d16d2916991d618d9}{serGPS}.begin(\hyperlink{logging-device_8ino_af0875ffe69dbe45df3f85c1f720c3eee}{GPS\_BAUD});
110 \}
\end{DoxyCode}
\mbox{\Hypertarget{logging-device_8ino_afe461d27b9c48d5921c00d521181f12f}\label{logging-device_8ino_afe461d27b9c48d5921c00d521181f12f}} 
\index{logging-\/device.\+ino@{logging-\/device.\+ino}!loop@{loop}}
\index{loop@{loop}!logging-\/device.\+ino@{logging-\/device.\+ino}}
\subsubsection{\texorpdfstring{loop()}{loop()}}
{\footnotesize\ttfamily void loop (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Main system loop for arduino. 

Checks serial to see if any commands are available. ~\newline
If available reads the byte and changes system mode relating to it. ~\newline
~\newline
System state machine is also iterated through each loop. ~\newline
Relevant procedure depending on system state is then called. 

References B\+T\+\_\+\+S\+E\+R\+I\+AL, parse\+New\+Mode(), and system\+Mode.


\begin{DoxyCode}
121 \{
122 
123   \textcolor{comment}{/* Check if mode change character received from front-end */}
124   \textcolor{keywordflow}{if} (\hyperlink{logging-device_8ino_ad1e6e6f6fc813b305067b9e1b0777ea6}{BT\_SERIAL}.available() > 0)
125   \{
126     \textcolor{keywordtype}{char} modeChar = \hyperlink{logging-device_8ino_ad1e6e6f6fc813b305067b9e1b0777ea6}{BT\_SERIAL}.read();
127 
128     \hyperlink{logging-device_8ino_a980e950615d86dadef54f3cfaefb5fb4}{OPERATING\_MODE} newMode;
129 
130     \textcolor{comment}{/* If valid new mode character found change system state */}
131     \textcolor{keywordflow}{if} (\hyperlink{logging-device_8ino_aec1eb39e3cfde6331c4d29938c952c84}{parseNewMode}(modeChar, newMode) == \textcolor{keyword}{true})
132     \{
133       \hyperlink{logging-device_8ino_a13a2ecbcf455940dd240e54e9e39cf7a}{systemMode} = newMode;
134     \}
135   \}
136 
137   \textcolor{comment}{/* State machine for choosing what option takes place */}
138   \textcolor{keywordflow}{switch} (\hyperlink{logging-device_8ino_a13a2ecbcf455940dd240e54e9e39cf7a}{systemMode})
139   \{
140     \textcolor{keywordflow}{case} IDLE:
141     \{
142       \textcolor{comment}{/*}
143 \textcolor{comment}{       * In IDLE mode MCU does nothing.}
144 \textcolor{comment}{       * System waits and still parses incoming commands.}
145 \textcolor{comment}{       */}
146       \textcolor{keywordflow}{break};
147     \}
148 
149     \textcolor{keywordflow}{case} REALTIME:
150     \{
151       \hyperlink{logging-device_8ino_ab4c1c4c0fa047e336f9f4176406a54f1}{realTimeMode}();
152       \textcolor{keywordflow}{break};
153     \}
154   \}
155 \}
\end{DoxyCode}
\mbox{\Hypertarget{logging-device_8ino_aec1eb39e3cfde6331c4d29938c952c84}\label{logging-device_8ino_aec1eb39e3cfde6331c4d29938c952c84}} 
\index{logging-\/device.\+ino@{logging-\/device.\+ino}!parse\+New\+Mode@{parse\+New\+Mode}}
\index{parse\+New\+Mode@{parse\+New\+Mode}!logging-\/device.\+ino@{logging-\/device.\+ino}}
\subsubsection{\texorpdfstring{parse\+New\+Mode()}{parseNewMode()}}
{\footnotesize\ttfamily bool parse\+New\+Mode (\begin{DoxyParamCaption}\item[{char}]{mode\+Char,  }\item[{\hyperlink{logging-device_8ino_a980e950615d86dadef54f3cfaefb5fb4}{O\+P\+E\+R\+A\+T\+I\+N\+G\+\_\+\+M\+O\+DE} \&}]{new\+Mode }\end{DoxyParamCaption})}



Returns whether system should change operating mode. 


\begin{DoxyParams}{Parameters}
{\em mode\+Char} & -\/ The received command byte \\
\hline
{\em \&new\+Mode} & -\/ Reference to new operating mode calculated via command. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
bool -\/ Whether a valid command was found. 
\end{DoxyReturn}


References I\+D\+L\+E\+\_\+\+C\+H\+AR.


\begin{DoxyCode}
165 \{
166   \textcolor{keywordtype}{bool} result = \textcolor{keyword}{true};
167 
168   \textcolor{keywordflow}{switch} (modeChar)
169   \{
170     \textcolor{keywordflow}{case} \hyperlink{logging-device_8ino_ad7f0721d7856c100a69be7fa82e2865b}{IDLE\_CHAR}:
171     \{
172       newMode = IDLE;
173       \textcolor{keywordflow}{break};
174     \}
175 
176     \textcolor{keywordflow}{case} \hyperlink{logging-device_8ino_a911a5839eebf5e3d5927f4f77e9bfb62}{REALTIME\_CHAR}:
177     \{
178       \textcolor{comment}{/* Change mode and then generate new file name for new log */}
179       \textcolor{keywordflow}{if} (\hyperlink{logging-device_8ino_a13a2ecbcf455940dd240e54e9e39cf7a}{systemMode} != REALTIME)
180       \{
181         \textcolor{comment}{/* Generate new name if not already in this mode */}
182         \hyperlink{logging-device_8ino_a40059244119c00baa1b841119cfd1b2e}{storage}.\hyperlink{class_storage_a571ce9630665d9407ffbaeff55c47b0a}{generateFileName}();
183       \}
184 
185       newMode = REALTIME;
186       \textcolor{keywordflow}{break};
187     \}
188 
189     \textcolor{keywordflow}{case} \hyperlink{logging-device_8ino_a4ffb22b7b0017657087830d24f68a323}{LIST\_SAVED\_CHAR}:
190     \{
191       \textcolor{comment}{/*}
192 \textcolor{comment}{       * Load all trips and send to application.}
193 \textcolor{comment}{       * Once we have finished sending trips we can go back to idle mode.}
194 \textcolor{comment}{       */}
195       \hyperlink{logging-device_8ino_a40059244119c00baa1b841119cfd1b2e}{storage}.\hyperlink{class_storage_a4831b2e8ecfa22da6971f5a8690cc4e3}{loadTripNames}();
196       newMode = IDLE;
197       \textcolor{keywordflow}{break};
198     \}
199 
200     \textcolor{keywordflow}{case} \hyperlink{logging-device_8ino_aa72e33a6bcfedf9118f573741b4e137b}{LOAD\_TRIP\_CHAR}:
201     \{
202       \textcolor{comment}{/* Load a specific trip by file name */}
203       \hyperlink{logging-device_8ino_a40059244119c00baa1b841119cfd1b2e}{storage}.\hyperlink{class_storage_af56ca8289ed925300e3385114c561eec}{loadSavedTrip}();
204       newMode = IDLE;
205       \textcolor{keywordflow}{break};
206     \}
207 
208     \textcolor{keywordflow}{default}:
209     \{
210       \textcolor{comment}{/*}
211 \textcolor{comment}{       * If not a valid operating mode character}
212 \textcolor{comment}{       * then return that parsing failed.}
213 \textcolor{comment}{       */}
214       result = \textcolor{keyword}{false};
215     \}
216   \}
217 
218   \textcolor{keywordflow}{return} result;
219 \}
\end{DoxyCode}
\mbox{\Hypertarget{logging-device_8ino_ab4c1c4c0fa047e336f9f4176406a54f1}\label{logging-device_8ino_ab4c1c4c0fa047e336f9f4176406a54f1}} 
\index{logging-\/device.\+ino@{logging-\/device.\+ino}!real\+Time\+Mode@{real\+Time\+Mode}}
\index{real\+Time\+Mode@{real\+Time\+Mode}!logging-\/device.\+ino@{logging-\/device.\+ino}}
\subsubsection{\texorpdfstring{real\+Time\+Mode()}{realTimeMode()}}
{\footnotesize\ttfamily void real\+Time\+Mode (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Responsible for completing work needed in relatime mode. 

Every time called this procedure will poll the I\+MU to update our orientation class with newest information. ~\newline
If available N\+M\+EA sentences received from G\+PS serial are sent to our G\+PS parsing object. ~\newline
 Every 1000ms all current information is transmitted via bluetooth, this information is also stored to the u\+SD so it can be retrieved at a later point. 

References add\+G\+P\+S\+To\+J\+S\+O\+N(), add\+Orientation\+To\+J\+S\+O\+N(), add\+Time\+To\+J\+S\+O\+N(), B\+T\+\_\+\+S\+E\+R\+I\+AL, gps, L\+E\+D\+\_\+\+P\+IN, main\+J\+S\+ON, Orientation\+::poll\+I\+M\+U(), Storage\+::save\+To\+File(), and ser\+G\+P\+S().


\begin{DoxyCode}
234 \{
235   \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} MAX\_STRING\_SIZE = 512;
236   \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} PRINT\_DELAY = 1000;
237   \textcolor{keyword}{static} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} lastMillis = 0;
238   \textcolor{keywordtype}{char} jsonString[MAX\_STRING\_SIZE];
239 
240   \textcolor{comment}{/* Poll our IMU to update XYZ */}
241   \hyperlink{logging-device_8ino_a47be0262307aa023a1bda3d98986a16d}{orientation}.\hyperlink{class_orientation_aad568a473f999c181abac46a4d832387}{pollIMU}();
242 
243   \textcolor{comment}{/* Parse NMEA codes into GPS object */}
244   \textcolor{keywordflow}{while} (\hyperlink{logging-device_8ino_aa2475f51bdc0f31d16d2916991d618d9}{serGPS}.available() > 0)
245   \{
246     \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.encode(\hyperlink{logging-device_8ino_aa2475f51bdc0f31d16d2916991d618d9}{serGPS}.read());
247   \}
248 
249   \textcolor{comment}{/* Print orientation and location information */}
250   \textcolor{keywordflow}{if} ((millis() - lastMillis) > PRINT\_DELAY)
251   \{
252     digitalWrite(\hyperlink{logging-device_8ino_ab4553be4db9860d940f81d7447173b2f}{LED\_PIN}, HIGH);
253 
254     \hyperlink{logging-device_8ino_a8d3614b16b26b9734d79e9f8f6695af3}{addOrientationToJSON}();
255     \hyperlink{logging-device_8ino_af1705fad6a6282b24379a174e18d4fe4}{addGPSToJSON}();
256     \hyperlink{logging-device_8ino_a9e4931f452cd25dfff67d41e7c9c0efb}{addTimeToJSON}();
257 
258     \textcolor{comment}{/* Print our json object into a string */}
259     \hyperlink{logging-device_8ino_a5eebfb3b76a83174d0f5d032d1f6bfb7}{mainJSON}.printTo(jsonString, MAX\_STRING\_SIZE);
260 
261     \textcolor{comment}{/* Log JSON to the microSD */}
262     \hyperlink{logging-device_8ino_a40059244119c00baa1b841119cfd1b2e}{storage}.\hyperlink{class_storage_a044a17325b2917afca49aa19ddb488f6}{saveToFile}(jsonString, \textcolor{keyword}{true});
263 
264     \textcolor{comment}{/* Print to our bluetooth module */}
265     \hyperlink{logging-device_8ino_ad1e6e6f6fc813b305067b9e1b0777ea6}{BT\_SERIAL}.println(jsonString);
266 
267     lastMillis = millis();
268     digitalWrite(\hyperlink{logging-device_8ino_ab4553be4db9860d940f81d7447173b2f}{LED\_PIN}, LOW);
269   \}
270 \}
\end{DoxyCode}
\mbox{\Hypertarget{logging-device_8ino_a8d3614b16b26b9734d79e9f8f6695af3}\label{logging-device_8ino_a8d3614b16b26b9734d79e9f8f6695af3}} 
\index{logging-\/device.\+ino@{logging-\/device.\+ino}!add\+Orientation\+To\+J\+S\+ON@{add\+Orientation\+To\+J\+S\+ON}}
\index{add\+Orientation\+To\+J\+S\+ON@{add\+Orientation\+To\+J\+S\+ON}!logging-\/device.\+ino@{logging-\/device.\+ino}}
\subsubsection{\texorpdfstring{add\+Orientation\+To\+J\+S\+O\+N()}{addOrientationToJSON()}}
{\footnotesize\ttfamily void add\+Orientation\+To\+J\+S\+ON (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Responsible for updating orientation J\+S\+ON object with newest information. 

Interacts with devices \hyperlink{class_orientation}{Orientation} object to get Yaw, Pitch \& Roll. 

References Orientation\+::get\+Pitch(), Orientation\+::get\+Roll(), and Orientation\+::get\+Yaw().


\begin{DoxyCode}
280 \{
281   \hyperlink{logging-device_8ino_ae8e95a76df2aaa373792e5b744a6bb73}{orientJSON}[\textcolor{stringliteral}{"yaw"}] = \hyperlink{logging-device_8ino_a47be0262307aa023a1bda3d98986a16d}{orientation}.\hyperlink{class_orientation_a3dbaa1ee014811c40d5b9f39b544c19b}{getYaw}();
282   \hyperlink{logging-device_8ino_ae8e95a76df2aaa373792e5b744a6bb73}{orientJSON}[\textcolor{stringliteral}{"pitch"}] = \hyperlink{logging-device_8ino_a47be0262307aa023a1bda3d98986a16d}{orientation}.\hyperlink{class_orientation_a7ec1a2964fc858bbd5da22a505b087c8}{getPitch}();
283   \hyperlink{logging-device_8ino_ae8e95a76df2aaa373792e5b744a6bb73}{orientJSON}[\textcolor{stringliteral}{"roll"}] = \hyperlink{logging-device_8ino_a47be0262307aa023a1bda3d98986a16d}{orientation}.\hyperlink{class_orientation_ab8923432cb8c18822b0a9ae95a5ac505}{getRoll}();
284 \}
\end{DoxyCode}
\mbox{\Hypertarget{logging-device_8ino_af1705fad6a6282b24379a174e18d4fe4}\label{logging-device_8ino_af1705fad6a6282b24379a174e18d4fe4}} 
\index{logging-\/device.\+ino@{logging-\/device.\+ino}!add\+G\+P\+S\+To\+J\+S\+ON@{add\+G\+P\+S\+To\+J\+S\+ON}}
\index{add\+G\+P\+S\+To\+J\+S\+ON@{add\+G\+P\+S\+To\+J\+S\+ON}!logging-\/device.\+ino@{logging-\/device.\+ino}}
\subsubsection{\texorpdfstring{add\+G\+P\+S\+To\+J\+S\+O\+N()}{addGPSToJSON()}}
{\footnotesize\ttfamily void add\+G\+P\+S\+To\+J\+S\+ON (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Responsible for updating G\+PS J\+S\+ON object with newest information. 

Interacts with devices Tiny\+G\+P\+S\+Plus object to get all locational/gps related information. Floats are cat\textquotesingle{}d to 6 digits max. 

References gps.


\begin{DoxyCode}
295 \{
296   \textcolor{comment}{/* Add location information */}
297   \hyperlink{logging-device_8ino_a548727e041a5cd3db91bdbd0ccd71e30}{gpsJSON}[\textcolor{stringliteral}{"gps\_valid"}] = \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.location.isUpdated();
298   \hyperlink{logging-device_8ino_a548727e041a5cd3db91bdbd0ccd71e30}{gpsJSON}[\textcolor{stringliteral}{"lat"}] = double\_with\_n\_digits(\hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.location.lat(), 6);
299   \hyperlink{logging-device_8ino_a548727e041a5cd3db91bdbd0ccd71e30}{gpsJSON}[\textcolor{stringliteral}{"lng"}] = double\_with\_n\_digits(\hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.location.lng(), 6);
300 
301   \textcolor{comment}{/* Other crucial GPS information */}
302   gpsJSON[\textcolor{stringliteral}{"available"}] = \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.satellites.value();
303   gpsJSON[\textcolor{stringliteral}{"vel\_mph"}] = \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.speed.mph();
304   gpsJSON[\textcolor{stringliteral}{"alt\_ft"}] = \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.altitude.feet();
305 \}
\end{DoxyCode}
\mbox{\Hypertarget{logging-device_8ino_a9e4931f452cd25dfff67d41e7c9c0efb}\label{logging-device_8ino_a9e4931f452cd25dfff67d41e7c9c0efb}} 
\index{logging-\/device.\+ino@{logging-\/device.\+ino}!add\+Time\+To\+J\+S\+ON@{add\+Time\+To\+J\+S\+ON}}
\index{add\+Time\+To\+J\+S\+ON@{add\+Time\+To\+J\+S\+ON}!logging-\/device.\+ino@{logging-\/device.\+ino}}
\subsubsection{\texorpdfstring{add\+Time\+To\+J\+S\+O\+N()}{addTimeToJSON()}}
{\footnotesize\ttfamily void add\+Time\+To\+J\+S\+ON (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Responsible for updating time J\+S\+ON object with newest information. 

Interacts with devices Tiny\+G\+P\+S\+Plus object to get time related information. This is because G\+PS module has a R\+TC (Realtime-\/\+Clock) kept via N\+M\+EA sentences. 

References gps.


\begin{DoxyCode}
317 \{
318   \textcolor{comment}{/* Add time information to JSON */}
319   \hyperlink{logging-device_8ino_acc172a29cb5ff709b48b650d9fb6503c}{timeJSON}[\textcolor{stringliteral}{"time\_valid"}] = \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.date.isValid() && \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.time.isValid();
320   \hyperlink{logging-device_8ino_acc172a29cb5ff709b48b650d9fb6503c}{timeJSON}[\textcolor{stringliteral}{"day"}] = \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.date.day();
321   \hyperlink{logging-device_8ino_acc172a29cb5ff709b48b650d9fb6503c}{timeJSON}[\textcolor{stringliteral}{"month"}] = \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.date.month();
322   \hyperlink{logging-device_8ino_acc172a29cb5ff709b48b650d9fb6503c}{timeJSON}[\textcolor{stringliteral}{"year"}] = \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.date.year();
323 
324   \hyperlink{logging-device_8ino_acc172a29cb5ff709b48b650d9fb6503c}{timeJSON}[\textcolor{stringliteral}{"hour"}] = \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.time.hour();
325   \hyperlink{logging-device_8ino_acc172a29cb5ff709b48b650d9fb6503c}{timeJSON}[\textcolor{stringliteral}{"minute"}] = \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.time.minute();
326   \hyperlink{logging-device_8ino_acc172a29cb5ff709b48b650d9fb6503c}{timeJSON}[\textcolor{stringliteral}{"second"}] = \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.time.second();
327   \hyperlink{logging-device_8ino_acc172a29cb5ff709b48b650d9fb6503c}{timeJSON}[\textcolor{stringliteral}{"centiseconds"}] = \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.time.centisecond();
328 \}
\end{DoxyCode}
