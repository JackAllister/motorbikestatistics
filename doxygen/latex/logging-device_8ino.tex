\hypertarget{logging-device_8ino}{}\section{logging-\/device/logging-\/device.ino File Reference}
\label{logging-device_8ino}\index{logging-\/device/logging-\/device.\+ino@{logging-\/device/logging-\/device.\+ino}}


Arduino sketch for the logging device.  


{\ttfamily \#include $<$Software\+Serial.\+h$>$}\newline
{\ttfamily \#include $<$Tiny\+G\+P\+S++.\+h$>$}\newline
{\ttfamily \#include $<$Arduino\+Json.\+h$>$}\newline
{\ttfamily \#include \char`\"{}Orientation.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Storage.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{logging-device_8ino_ad7f0721d7856c100a69be7fa82e2865b}\label{logging-device_8ino_ad7f0721d7856c100a69be7fa82e2865b}} 
\#define \hyperlink{logging-device_8ino_ad7f0721d7856c100a69be7fa82e2865b}{I\+D\+L\+E\+\_\+\+C\+H\+AR}~\textquotesingle{}0\textquotesingle{}
\begin{DoxyCompactList}\small\item\em Command to set system to idle mode. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_a911a5839eebf5e3d5927f4f77e9bfb62}\label{logging-device_8ino_a911a5839eebf5e3d5927f4f77e9bfb62}} 
\#define \hyperlink{logging-device_8ino_a911a5839eebf5e3d5927f4f77e9bfb62}{R\+E\+A\+L\+T\+I\+M\+E\+\_\+\+C\+H\+AR}~\textquotesingle{}1\textquotesingle{}
\begin{DoxyCompactList}\small\item\em Command to set system to realtime logging mode. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_a4ffb22b7b0017657087830d24f68a323}\label{logging-device_8ino_a4ffb22b7b0017657087830d24f68a323}} 
\#define \hyperlink{logging-device_8ino_a4ffb22b7b0017657087830d24f68a323}{L\+I\+S\+T\+\_\+\+S\+A\+V\+E\+D\+\_\+\+C\+H\+AR}~\textquotesingle{}2\textquotesingle{}
\begin{DoxyCompactList}\small\item\em Command to list all saved trip names from u\+SD. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_aa72e33a6bcfedf9118f573741b4e137b}\label{logging-device_8ino_aa72e33a6bcfedf9118f573741b4e137b}} 
\#define \hyperlink{logging-device_8ino_aa72e33a6bcfedf9118f573741b4e137b}{L\+O\+A\+D\+\_\+\+T\+R\+I\+P\+\_\+\+C\+H\+AR}~\textquotesingle{}3\textquotesingle{}
\begin{DoxyCompactList}\small\item\em Command to load a trip stored on u\+SD. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_ad1e6e6f6fc813b305067b9e1b0777ea6}\label{logging-device_8ino_ad1e6e6f6fc813b305067b9e1b0777ea6}} 
\#define \hyperlink{logging-device_8ino_ad1e6e6f6fc813b305067b9e1b0777ea6}{B\+T\+\_\+\+S\+E\+R\+I\+AL}~Serial1
\begin{DoxyCompactList}\small\item\em Mapping for which H\+W-\/\+Serial port BT module is on. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_a6882992121626898bccaa43be51ba4c2}\label{logging-device_8ino_a6882992121626898bccaa43be51ba4c2}} 
\#define \hyperlink{logging-device_8ino_a6882992121626898bccaa43be51ba4c2}{B\+T\+\_\+\+B\+A\+UD}~115200
\begin{DoxyCompactList}\small\item\em B\+A\+UD rate of BT device. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_acae14b9c1767cfec367a4b96009c94e5}\label{logging-device_8ino_acae14b9c1767cfec367a4b96009c94e5}} 
\#define \hyperlink{logging-device_8ino_acae14b9c1767cfec367a4b96009c94e5}{G\+P\+S\+\_\+\+T\+X\+\_\+\+P\+IN}~9
\begin{DoxyCompactList}\small\item\em G\+PS serial transmit pin. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_a6f8927970de9eedcbb8f6c14b1d0d6c3}\label{logging-device_8ino_a6f8927970de9eedcbb8f6c14b1d0d6c3}} 
\#define \hyperlink{logging-device_8ino_a6f8927970de9eedcbb8f6c14b1d0d6c3}{G\+P\+S\+\_\+\+R\+X\+\_\+\+P\+IN}~8
\begin{DoxyCompactList}\small\item\em G\+PS serial receive pin. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_af0875ffe69dbe45df3f85c1f720c3eee}\label{logging-device_8ino_af0875ffe69dbe45df3f85c1f720c3eee}} 
\#define \hyperlink{logging-device_8ino_af0875ffe69dbe45df3f85c1f720c3eee}{G\+P\+S\+\_\+\+B\+A\+UD}~9600
\begin{DoxyCompactList}\small\item\em G\+PS serial baud rate. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_ab4553be4db9860d940f81d7447173b2f}\label{logging-device_8ino_ab4553be4db9860d940f81d7447173b2f}} 
\#define \hyperlink{logging-device_8ino_ab4553be4db9860d940f81d7447173b2f}{L\+E\+D\+\_\+\+P\+IN}~13
\begin{DoxyCompactList}\small\item\em L\+ED pin to indicate read. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{logging-device_8ino_a980e950615d86dadef54f3cfaefb5fb4}\label{logging-device_8ino_a980e950615d86dadef54f3cfaefb5fb4}} 
enum \hyperlink{logging-device_8ino_a980e950615d86dadef54f3cfaefb5fb4}{O\+P\+E\+R\+A\+T\+I\+N\+G\+\_\+\+M\+O\+DE} \{ {\bfseries I\+D\+LE}, 
{\bfseries R\+E\+A\+L\+T\+I\+ME}
 \}\begin{DoxyCompactList}\small\item\em Typedef holding two possible states for device. \end{DoxyCompactList}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{logging-device_8ino_aa2475f51bdc0f31d16d2916991d618d9}\label{logging-device_8ino_aa2475f51bdc0f31d16d2916991d618d9}} 
Software\+Serial \hyperlink{logging-device_8ino_aa2475f51bdc0f31d16d2916991d618d9}{ser\+G\+PS} (\hyperlink{logging-device_8ino_a6f8927970de9eedcbb8f6c14b1d0d6c3}{G\+P\+S\+\_\+\+R\+X\+\_\+\+P\+IN}, \hyperlink{logging-device_8ino_acae14b9c1767cfec367a4b96009c94e5}{G\+P\+S\+\_\+\+T\+X\+\_\+\+P\+IN})
\begin{DoxyCompactList}\small\item\em Serial object for communicating with G\+PS module. \end{DoxyCompactList}\item 
void \hyperlink{logging-device_8ino_a4fc01d736fe50cf5b977f755b675f11d}{setup} ()
\begin{DoxyCompactList}\small\item\em Runs once at boot of arduino. \end{DoxyCompactList}\item 
void \hyperlink{logging-device_8ino_afe461d27b9c48d5921c00d521181f12f}{loop} ()
\begin{DoxyCompactList}\small\item\em Main system loop for arduino. \end{DoxyCompactList}\item 
bool \hyperlink{logging-device_8ino_aec1eb39e3cfde6331c4d29938c952c84}{parse\+New\+Mode} (char mode\+Char, \hyperlink{logging-device_8ino_a980e950615d86dadef54f3cfaefb5fb4}{O\+P\+E\+R\+A\+T\+I\+N\+G\+\_\+\+M\+O\+DE} \&new\+Mode)
\begin{DoxyCompactList}\small\item\em Returns whether system should change operating mode. \end{DoxyCompactList}\item 
void \hyperlink{logging-device_8ino_ab4c1c4c0fa047e336f9f4176406a54f1}{real\+Time\+Mode} ()
\begin{DoxyCompactList}\small\item\em Responsible for completing work needed in relatime mode. \end{DoxyCompactList}\item 
void \hyperlink{logging-device_8ino_a8d3614b16b26b9734d79e9f8f6695af3}{add\+Orientation\+To\+J\+S\+ON} ()
\begin{DoxyCompactList}\small\item\em Responsible for updating orientation J\+S\+ON object with newest information. \end{DoxyCompactList}\item 
void \hyperlink{logging-device_8ino_af1705fad6a6282b24379a174e18d4fe4}{add\+G\+P\+S\+To\+J\+S\+ON} ()
\begin{DoxyCompactList}\small\item\em Responsible for updating G\+PS J\+S\+ON object with newest information. \end{DoxyCompactList}\item 
void \hyperlink{logging-device_8ino_a9e4931f452cd25dfff67d41e7c9c0efb}{add\+Time\+To\+J\+S\+ON} ()
\begin{DoxyCompactList}\small\item\em Responsible for updating time J\+S\+ON object with newest information. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{logging-device_8ino_a13a2ecbcf455940dd240e54e9e39cf7a}\label{logging-device_8ino_a13a2ecbcf455940dd240e54e9e39cf7a}} 
\hyperlink{logging-device_8ino_a980e950615d86dadef54f3cfaefb5fb4}{O\+P\+E\+R\+A\+T\+I\+N\+G\+\_\+\+M\+O\+DE} \hyperlink{logging-device_8ino_a13a2ecbcf455940dd240e54e9e39cf7a}{system\+Mode} = I\+D\+LE
\begin{DoxyCompactList}\small\item\em State machine for system state of device. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_a47be0262307aa023a1bda3d98986a16d}\label{logging-device_8ino_a47be0262307aa023a1bda3d98986a16d}} 
\hyperlink{class_orientation}{Orientation} \hyperlink{logging-device_8ino_a47be0262307aa023a1bda3d98986a16d}{orientation}
\begin{DoxyCompactList}\small\item\em \hyperlink{class_orientation}{Orientation} object, used for receiving device orientation. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_a40059244119c00baa1b841119cfd1b2e}\label{logging-device_8ino_a40059244119c00baa1b841119cfd1b2e}} 
\hyperlink{class_storage}{Storage} \hyperlink{logging-device_8ino_a40059244119c00baa1b841119cfd1b2e}{storage}
\begin{DoxyCompactList}\small\item\em \hyperlink{class_storage}{Storage} object, responsible for saving \& loading from u\+SD. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}\label{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}} 
Tiny\+G\+P\+S\+Plus \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}
\begin{DoxyCompactList}\small\item\em Our G\+PS object, responsible for parsing N\+M\+EA codes. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_ae3799d2cbf8f13e21cbaef64b75c6833}\label{logging-device_8ino_ae3799d2cbf8f13e21cbaef64b75c6833}} 
Static\+Json\+Buffer$<$ 500 $>$ \hyperlink{logging-device_8ino_ae3799d2cbf8f13e21cbaef64b75c6833}{json\+Buffer}
\begin{DoxyCompactList}\small\item\em Allocated space for holding all J\+S\+ON objects within. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_a5eebfb3b76a83174d0f5d032d1f6bfb7}\label{logging-device_8ino_a5eebfb3b76a83174d0f5d032d1f6bfb7}} 
Json\+Object \& \hyperlink{logging-device_8ino_a5eebfb3b76a83174d0f5d032d1f6bfb7}{main\+J\+S\+ON} = json\+Buffer.\+create\+Object()
\begin{DoxyCompactList}\small\item\em Parent J\+S\+ON object, holds orientation, time \& gps children. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_ae8e95a76df2aaa373792e5b744a6bb73}\label{logging-device_8ino_ae8e95a76df2aaa373792e5b744a6bb73}} 
Json\+Object \& \hyperlink{logging-device_8ino_ae8e95a76df2aaa373792e5b744a6bb73}{orient\+J\+S\+ON} = main\+J\+S\+O\+N.\+create\+Nested\+Object(\char`\"{}orientation\char`\"{})
\begin{DoxyCompactList}\small\item\em Holds all orientation related information. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_a548727e041a5cd3db91bdbd0ccd71e30}\label{logging-device_8ino_a548727e041a5cd3db91bdbd0ccd71e30}} 
Json\+Object \& \hyperlink{logging-device_8ino_a548727e041a5cd3db91bdbd0ccd71e30}{gps\+J\+S\+ON} = main\+J\+S\+O\+N.\+create\+Nested\+Object(\char`\"{}gps\char`\"{})
\begin{DoxyCompactList}\small\item\em Holds all location related information. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{logging-device_8ino_acc172a29cb5ff709b48b650d9fb6503c}\label{logging-device_8ino_acc172a29cb5ff709b48b650d9fb6503c}} 
Json\+Object \& \hyperlink{logging-device_8ino_acc172a29cb5ff709b48b650d9fb6503c}{time\+J\+S\+ON} = main\+J\+S\+O\+N.\+create\+Nested\+Object(\char`\"{}time\char`\"{})
\begin{DoxyCompactList}\small\item\em Holds all time related inforamtion. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Arduino sketch for the logging device. 

\begin{DoxyAuthor}{Author}
Jack Allister -\/ 23042098 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
2016-\/2017
\begin{DoxyItemize}
\item Arduino 101
\item Sparkfun G\+PS Logger shield
\item Onboard gyroscope + accelerometer
\item H\+C-\/06 Serial Bluetooth Module 
\end{DoxyItemize}
\end{DoxyDate}


\subsection{Function Documentation}
\mbox{\Hypertarget{logging-device_8ino_a4fc01d736fe50cf5b977f755b675f11d}\label{logging-device_8ino_a4fc01d736fe50cf5b977f755b675f11d}} 
\index{logging-\/device.\+ino@{logging-\/device.\+ino}!setup@{setup}}
\index{setup@{setup}!logging-\/device.\+ino@{logging-\/device.\+ino}}
\subsubsection{\texorpdfstring{setup()}{setup()}}
{\footnotesize\ttfamily void setup (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Runs once at boot of arduino. 

Responsible for setting up the peripherals. ~\newline
Initialises modules such as storage, bluetooth \& gps. 

References B\+T\+\_\+\+B\+A\+UD, B\+T\+\_\+\+S\+E\+R\+I\+AL, G\+P\+S\+\_\+\+B\+A\+UD, L\+E\+D\+\_\+\+P\+IN, and ser\+G\+P\+S().


\begin{DoxyCode}
98 \{
99   pinMode(\hyperlink{logging-device_8ino_ab4553be4db9860d940f81d7447173b2f}{LED\_PIN}, OUTPUT);
100 
101   \textcolor{comment}{/* Initialise our storage module */}
102   \hyperlink{logging-device_8ino_a40059244119c00baa1b841119cfd1b2e}{storage}.init();
103 
104   \textcolor{comment}{/* Set up serial for data transmission */}
105   \hyperlink{logging-device_8ino_ad1e6e6f6fc813b305067b9e1b0777ea6}{BT\_SERIAL}.begin(\hyperlink{logging-device_8ino_a6882992121626898bccaa43be51ba4c2}{BT\_BAUD});
106 
107   \textcolor{comment}{/* Set up GPS */}
108   \hyperlink{logging-device_8ino_aa2475f51bdc0f31d16d2916991d618d9}{serGPS}.begin(\hyperlink{logging-device_8ino_af0875ffe69dbe45df3f85c1f720c3eee}{GPS\_BAUD});
109 \}
\end{DoxyCode}
\mbox{\Hypertarget{logging-device_8ino_afe461d27b9c48d5921c00d521181f12f}\label{logging-device_8ino_afe461d27b9c48d5921c00d521181f12f}} 
\index{logging-\/device.\+ino@{logging-\/device.\+ino}!loop@{loop}}
\index{loop@{loop}!logging-\/device.\+ino@{logging-\/device.\+ino}}
\subsubsection{\texorpdfstring{loop()}{loop()}}
{\footnotesize\ttfamily void loop (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Main system loop for arduino. 

Checks serial to see if any commands are available. ~\newline
If available reads the byte and changes system mode relating to it. ~\newline
~\newline
System state machine is also iterated through each loop. ~\newline
Relevant procedure depending on system state is then called. 

References B\+T\+\_\+\+S\+E\+R\+I\+AL, parse\+New\+Mode(), and system\+Mode.


\begin{DoxyCode}
120 \{
121 
122   \textcolor{comment}{/* Check if mode change character received from front-end */}
123   \textcolor{keywordflow}{if} (\hyperlink{logging-device_8ino_ad1e6e6f6fc813b305067b9e1b0777ea6}{BT\_SERIAL}.available() > 0)
124   \{
125     \textcolor{keywordtype}{char} modeChar = \hyperlink{logging-device_8ino_ad1e6e6f6fc813b305067b9e1b0777ea6}{BT\_SERIAL}.read();
126 
127     \hyperlink{logging-device_8ino_a980e950615d86dadef54f3cfaefb5fb4}{OPERATING\_MODE} newMode;
128 
129     \textcolor{comment}{/* If valid new mode character found change system state */}
130     \textcolor{keywordflow}{if} (\hyperlink{logging-device_8ino_aec1eb39e3cfde6331c4d29938c952c84}{parseNewMode}(modeChar, newMode) == \textcolor{keyword}{true})
131     \{
132       \hyperlink{logging-device_8ino_a13a2ecbcf455940dd240e54e9e39cf7a}{systemMode} = newMode;
133     \}
134   \}
135 
136   \textcolor{comment}{/* State machine for choosing what option takes place */}
137   \textcolor{keywordflow}{switch} (\hyperlink{logging-device_8ino_a13a2ecbcf455940dd240e54e9e39cf7a}{systemMode})
138   \{
139     \textcolor{keywordflow}{case} IDLE:
140     \{
141       \textcolor{comment}{/*}
142 \textcolor{comment}{       * In IDLE mode MCU does nothing.}
143 \textcolor{comment}{       * System waits and still parses incoming commands.}
144 \textcolor{comment}{       */}
145       \textcolor{keywordflow}{break};
146     \}
147 
148     \textcolor{keywordflow}{case} REALTIME:
149     \{
150       \hyperlink{logging-device_8ino_ab4c1c4c0fa047e336f9f4176406a54f1}{realTimeMode}();
151       \textcolor{keywordflow}{break};
152     \}
153   \}
154 \}
\end{DoxyCode}
\mbox{\Hypertarget{logging-device_8ino_aec1eb39e3cfde6331c4d29938c952c84}\label{logging-device_8ino_aec1eb39e3cfde6331c4d29938c952c84}} 
\index{logging-\/device.\+ino@{logging-\/device.\+ino}!parse\+New\+Mode@{parse\+New\+Mode}}
\index{parse\+New\+Mode@{parse\+New\+Mode}!logging-\/device.\+ino@{logging-\/device.\+ino}}
\subsubsection{\texorpdfstring{parse\+New\+Mode()}{parseNewMode()}}
{\footnotesize\ttfamily bool parse\+New\+Mode (\begin{DoxyParamCaption}\item[{char}]{mode\+Char,  }\item[{\hyperlink{logging-device_8ino_a980e950615d86dadef54f3cfaefb5fb4}{O\+P\+E\+R\+A\+T\+I\+N\+G\+\_\+\+M\+O\+DE} \&}]{new\+Mode }\end{DoxyParamCaption})}



Returns whether system should change operating mode. 


\begin{DoxyParams}{Parameters}
{\em mode\+Char} & -\/ The received command byte \\
\hline
{\em \&new\+Mode} & -\/ Reference to new operating mode calculated via command. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
bool -\/ Whether a valid command was found. 
\end{DoxyReturn}


References I\+D\+L\+E\+\_\+\+C\+H\+AR.


\begin{DoxyCode}
164 \{
165   \textcolor{keywordtype}{bool} result = \textcolor{keyword}{true};
166 
167   \textcolor{keywordflow}{switch} (modeChar)
168   \{
169     \textcolor{keywordflow}{case} \hyperlink{logging-device_8ino_ad7f0721d7856c100a69be7fa82e2865b}{IDLE\_CHAR}:
170     \{
171       newMode = IDLE;
172       \textcolor{keywordflow}{break};
173     \}
174 
175     \textcolor{keywordflow}{case} \hyperlink{logging-device_8ino_a911a5839eebf5e3d5927f4f77e9bfb62}{REALTIME\_CHAR}:
176     \{
177       \textcolor{comment}{/* Change mode and then generate new file name for new log */}
178       \textcolor{keywordflow}{if} (\hyperlink{logging-device_8ino_a13a2ecbcf455940dd240e54e9e39cf7a}{systemMode} != REALTIME)
179       \{
180         \textcolor{comment}{/* Generate new name if not already in this mode */}
181         \hyperlink{logging-device_8ino_a40059244119c00baa1b841119cfd1b2e}{storage}.generateFileName();
182       \}
183 
184       newMode = REALTIME;
185       \textcolor{keywordflow}{break};
186     \}
187 
188     \textcolor{keywordflow}{case} \hyperlink{logging-device_8ino_a4ffb22b7b0017657087830d24f68a323}{LIST\_SAVED\_CHAR}:
189     \{
190       \textcolor{comment}{/*}
191 \textcolor{comment}{       * Load all trips and send to application.}
192 \textcolor{comment}{       * Once we have finished sending trips we can go back to idle mode.}
193 \textcolor{comment}{       */}
194       \hyperlink{logging-device_8ino_a40059244119c00baa1b841119cfd1b2e}{storage}.loadTripNames();
195       newMode = IDLE;
196       \textcolor{keywordflow}{break};
197     \}
198 
199     \textcolor{keywordflow}{case} \hyperlink{logging-device_8ino_aa72e33a6bcfedf9118f573741b4e137b}{LOAD\_TRIP\_CHAR}:
200     \{
201       \textcolor{comment}{/* Load a specific trip by file name */}
202       \hyperlink{logging-device_8ino_a40059244119c00baa1b841119cfd1b2e}{storage}.loadSavedTrip();
203       newMode = IDLE;
204       \textcolor{keywordflow}{break};
205     \}
206 
207     \textcolor{keywordflow}{default}:
208     \{
209       \textcolor{comment}{/*}
210 \textcolor{comment}{       * If not a valid operating mode character}
211 \textcolor{comment}{       * then return that parsing failed.}
212 \textcolor{comment}{       */}
213       result = \textcolor{keyword}{false};
214     \}
215   \}
216 
217   \textcolor{keywordflow}{return} result;
218 \}
\end{DoxyCode}
\mbox{\Hypertarget{logging-device_8ino_ab4c1c4c0fa047e336f9f4176406a54f1}\label{logging-device_8ino_ab4c1c4c0fa047e336f9f4176406a54f1}} 
\index{logging-\/device.\+ino@{logging-\/device.\+ino}!real\+Time\+Mode@{real\+Time\+Mode}}
\index{real\+Time\+Mode@{real\+Time\+Mode}!logging-\/device.\+ino@{logging-\/device.\+ino}}
\subsubsection{\texorpdfstring{real\+Time\+Mode()}{realTimeMode()}}
{\footnotesize\ttfamily void real\+Time\+Mode (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Responsible for completing work needed in relatime mode. 

Every time called this procedure will poll the I\+MU to update our orientation class with newest information. ~\newline
If available N\+M\+EA sentences received from G\+PS serial are sent to our G\+PS parsing object. ~\newline
 Every 1000ms all current information is transmitted via bluetooth, this information is also stored to the u\+SD so it can be retrieved at a later point. 

References add\+G\+P\+S\+To\+J\+S\+O\+N(), add\+Orientation\+To\+J\+S\+O\+N(), add\+Time\+To\+J\+S\+O\+N(), B\+T\+\_\+\+S\+E\+R\+I\+AL, gps, L\+E\+D\+\_\+\+P\+IN, main\+J\+S\+ON, and ser\+G\+P\+S().


\begin{DoxyCode}
233 \{
234   \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} MAX\_STRING\_SIZE = 512;
235   \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} PRINT\_DELAY = 1000;
236   \textcolor{keyword}{static} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} lastMillis = 0;
237   \textcolor{keywordtype}{char} jsonString[MAX\_STRING\_SIZE];
238 
239   \textcolor{comment}{/* Poll our IMU to update XYZ */}
240   \hyperlink{logging-device_8ino_a47be0262307aa023a1bda3d98986a16d}{orientation}.pollIMU();
241 
242   \textcolor{comment}{/* Parse NMEA codes into GPS object */}
243   \textcolor{keywordflow}{while} (\hyperlink{logging-device_8ino_aa2475f51bdc0f31d16d2916991d618d9}{serGPS}.available() > 0)
244   \{
245     \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.encode(\hyperlink{logging-device_8ino_aa2475f51bdc0f31d16d2916991d618d9}{serGPS}.read());
246   \}
247 
248   \textcolor{comment}{/* Print orientation and location information */}
249   \textcolor{keywordflow}{if} ((millis() - lastMillis) > PRINT\_DELAY)
250   \{
251     digitalWrite(\hyperlink{logging-device_8ino_ab4553be4db9860d940f81d7447173b2f}{LED\_PIN}, HIGH);
252 
253     \hyperlink{logging-device_8ino_a8d3614b16b26b9734d79e9f8f6695af3}{addOrientationToJSON}();
254     \hyperlink{logging-device_8ino_af1705fad6a6282b24379a174e18d4fe4}{addGPSToJSON}();
255     \hyperlink{logging-device_8ino_a9e4931f452cd25dfff67d41e7c9c0efb}{addTimeToJSON}();
256 
257     \textcolor{comment}{/* Print our json object into a string */}
258     \hyperlink{logging-device_8ino_a5eebfb3b76a83174d0f5d032d1f6bfb7}{mainJSON}.printTo(jsonString, MAX\_STRING\_SIZE);
259 
260     \textcolor{comment}{/* Log JSON to the microSD */}
261     \hyperlink{logging-device_8ino_a40059244119c00baa1b841119cfd1b2e}{storage}.saveToFile(jsonString, \textcolor{keyword}{true});
262 
263     \textcolor{comment}{/* Print to our bluetooth module */}
264     \hyperlink{logging-device_8ino_ad1e6e6f6fc813b305067b9e1b0777ea6}{BT\_SERIAL}.println(jsonString);
265 
266     lastMillis = millis();
267     digitalWrite(\hyperlink{logging-device_8ino_ab4553be4db9860d940f81d7447173b2f}{LED\_PIN}, LOW);
268   \}
269 \}
\end{DoxyCode}
\mbox{\Hypertarget{logging-device_8ino_a8d3614b16b26b9734d79e9f8f6695af3}\label{logging-device_8ino_a8d3614b16b26b9734d79e9f8f6695af3}} 
\index{logging-\/device.\+ino@{logging-\/device.\+ino}!add\+Orientation\+To\+J\+S\+ON@{add\+Orientation\+To\+J\+S\+ON}}
\index{add\+Orientation\+To\+J\+S\+ON@{add\+Orientation\+To\+J\+S\+ON}!logging-\/device.\+ino@{logging-\/device.\+ino}}
\subsubsection{\texorpdfstring{add\+Orientation\+To\+J\+S\+O\+N()}{addOrientationToJSON()}}
{\footnotesize\ttfamily void add\+Orientation\+To\+J\+S\+ON (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Responsible for updating orientation J\+S\+ON object with newest information. 

Interacts with devices \hyperlink{class_orientation}{Orientation} object to get Yaw, Pitch \& Roll. 
\begin{DoxyCode}
279 \{
280   \hyperlink{logging-device_8ino_ae8e95a76df2aaa373792e5b744a6bb73}{orientJSON}[\textcolor{stringliteral}{"yaw"}] = \hyperlink{logging-device_8ino_a47be0262307aa023a1bda3d98986a16d}{orientation}.getYaw();
281   \hyperlink{logging-device_8ino_ae8e95a76df2aaa373792e5b744a6bb73}{orientJSON}[\textcolor{stringliteral}{"pitch"}] = \hyperlink{logging-device_8ino_a47be0262307aa023a1bda3d98986a16d}{orientation}.getPitch();
282   \hyperlink{logging-device_8ino_ae8e95a76df2aaa373792e5b744a6bb73}{orientJSON}[\textcolor{stringliteral}{"roll"}] = \hyperlink{logging-device_8ino_a47be0262307aa023a1bda3d98986a16d}{orientation}.getRoll();
283 \}
\end{DoxyCode}
\mbox{\Hypertarget{logging-device_8ino_af1705fad6a6282b24379a174e18d4fe4}\label{logging-device_8ino_af1705fad6a6282b24379a174e18d4fe4}} 
\index{logging-\/device.\+ino@{logging-\/device.\+ino}!add\+G\+P\+S\+To\+J\+S\+ON@{add\+G\+P\+S\+To\+J\+S\+ON}}
\index{add\+G\+P\+S\+To\+J\+S\+ON@{add\+G\+P\+S\+To\+J\+S\+ON}!logging-\/device.\+ino@{logging-\/device.\+ino}}
\subsubsection{\texorpdfstring{add\+G\+P\+S\+To\+J\+S\+O\+N()}{addGPSToJSON()}}
{\footnotesize\ttfamily void add\+G\+P\+S\+To\+J\+S\+ON (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Responsible for updating G\+PS J\+S\+ON object with newest information. 

Interacts with devices Tiny\+G\+P\+S\+Plus object to get all locational/gps related information. Floats are cat\textquotesingle{}d to 6 digits max. 

References gps.


\begin{DoxyCode}
294 \{
295   \textcolor{comment}{/* Add location information */}
296   \hyperlink{logging-device_8ino_a548727e041a5cd3db91bdbd0ccd71e30}{gpsJSON}[\textcolor{stringliteral}{"gps\_valid"}] = \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.location.isUpdated();
297   \hyperlink{logging-device_8ino_a548727e041a5cd3db91bdbd0ccd71e30}{gpsJSON}[\textcolor{stringliteral}{"lat"}] = double\_with\_n\_digits(\hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.location.lat(), 6);
298   \hyperlink{logging-device_8ino_a548727e041a5cd3db91bdbd0ccd71e30}{gpsJSON}[\textcolor{stringliteral}{"lng"}] = double\_with\_n\_digits(\hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.location.lng(), 6);
299 
300   \textcolor{comment}{/* Other crucial GPS information */}
301   gpsJSON[\textcolor{stringliteral}{"available"}] = \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.satellites.value();
302   gpsJSON[\textcolor{stringliteral}{"vel\_mph"}] = \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.speed.mph();
303   gpsJSON[\textcolor{stringliteral}{"alt\_ft"}] = \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.altitude.feet();
304 \}
\end{DoxyCode}
\mbox{\Hypertarget{logging-device_8ino_a9e4931f452cd25dfff67d41e7c9c0efb}\label{logging-device_8ino_a9e4931f452cd25dfff67d41e7c9c0efb}} 
\index{logging-\/device.\+ino@{logging-\/device.\+ino}!add\+Time\+To\+J\+S\+ON@{add\+Time\+To\+J\+S\+ON}}
\index{add\+Time\+To\+J\+S\+ON@{add\+Time\+To\+J\+S\+ON}!logging-\/device.\+ino@{logging-\/device.\+ino}}
\subsubsection{\texorpdfstring{add\+Time\+To\+J\+S\+O\+N()}{addTimeToJSON()}}
{\footnotesize\ttfamily void add\+Time\+To\+J\+S\+ON (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Responsible for updating time J\+S\+ON object with newest information. 

Interacts with devices Tiny\+G\+P\+S\+Plus object to get time related information. This is because G\+PS module has a R\+TC (Realtime-\/\+Clock) kept via N\+M\+EA sentences. 

References gps.


\begin{DoxyCode}
316 \{
317   \textcolor{comment}{/* Add time information to JSON */}
318   \hyperlink{logging-device_8ino_acc172a29cb5ff709b48b650d9fb6503c}{timeJSON}[\textcolor{stringliteral}{"time\_valid"}] = \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.date.isValid() && \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.time.isValid();
319   \hyperlink{logging-device_8ino_acc172a29cb5ff709b48b650d9fb6503c}{timeJSON}[\textcolor{stringliteral}{"day"}] = \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.date.day();
320   \hyperlink{logging-device_8ino_acc172a29cb5ff709b48b650d9fb6503c}{timeJSON}[\textcolor{stringliteral}{"month"}] = \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.date.month();
321   \hyperlink{logging-device_8ino_acc172a29cb5ff709b48b650d9fb6503c}{timeJSON}[\textcolor{stringliteral}{"year"}] = \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.date.year();
322 
323   \hyperlink{logging-device_8ino_acc172a29cb5ff709b48b650d9fb6503c}{timeJSON}[\textcolor{stringliteral}{"hour"}] = \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.time.hour();
324   \hyperlink{logging-device_8ino_acc172a29cb5ff709b48b650d9fb6503c}{timeJSON}[\textcolor{stringliteral}{"minute"}] = \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.time.minute();
325   \hyperlink{logging-device_8ino_acc172a29cb5ff709b48b650d9fb6503c}{timeJSON}[\textcolor{stringliteral}{"second"}] = \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.time.second();
326   \hyperlink{logging-device_8ino_acc172a29cb5ff709b48b650d9fb6503c}{timeJSON}[\textcolor{stringliteral}{"centiseconds"}] = \hyperlink{logging-device_8ino_a169c53997a7da1d0fb99aec1b4675ce8}{gps}.time.centisecond();
327 \}
\end{DoxyCode}
