<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Motorbike Statistics: Storage Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Motorbike Statistics
   </div>
   <div id="projectbrief">A system for logging statistics of motorbikes</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="class_storage-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">Storage Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Class for storing &amp; retrieving data on the logging device.  
 <a href="class_storage.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="_storage_8h_source.html">Storage.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a98b01eb20a64a4bf4127685147f7f6f1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_storage.html#a98b01eb20a64a4bf4127685147f7f6f1">init</a> ()</td></tr>
<tr class="memdesc:a98b01eb20a64a4bf4127685147f7f6f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialisation function for storage module.  <a href="#a98b01eb20a64a4bf4127685147f7f6f1">More...</a><br /></td></tr>
<tr class="separator:a98b01eb20a64a4bf4127685147f7f6f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a044a17325b2917afca49aa19ddb488f6"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_storage.html#a044a17325b2917afca49aa19ddb488f6">saveToFile</a> (char data[], bool newLine)</td></tr>
<tr class="memdesc:a044a17325b2917afca49aa19ddb488f6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Saves a single line of data to a file.  <a href="#a044a17325b2917afca49aa19ddb488f6">More...</a><br /></td></tr>
<tr class="separator:a044a17325b2917afca49aa19ddb488f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a571ce9630665d9407ffbaeff55c47b0a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_storage.html#a571ce9630665d9407ffbaeff55c47b0a">generateFileName</a> ()</td></tr>
<tr class="memdesc:a571ce9630665d9407ffbaeff55c47b0a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates a new filename to use for saving.  <a href="#a571ce9630665d9407ffbaeff55c47b0a">More...</a><br /></td></tr>
<tr class="separator:a571ce9630665d9407ffbaeff55c47b0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4831b2e8ecfa22da6971f5a8690cc4e3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_storage.html#a4831b2e8ecfa22da6971f5a8690cc4e3">loadTripNames</a> ()</td></tr>
<tr class="memdesc:a4831b2e8ecfa22da6971f5a8690cc4e3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Loads the information of all trips and sends them over bluetooth.  <a href="#a4831b2e8ecfa22da6971f5a8690cc4e3">More...</a><br /></td></tr>
<tr class="separator:a4831b2e8ecfa22da6971f5a8690cc4e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af56ca8289ed925300e3385114c561eec"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_storage.html#af56ca8289ed925300e3385114c561eec">loadSavedTrip</a> ()</td></tr>
<tr class="memdesc:af56ca8289ed925300e3385114c561eec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Loads a saved trip and sends data to client via Serial.  <a href="#af56ca8289ed925300e3385114c561eec">More...</a><br /></td></tr>
<tr class="separator:af56ca8289ed925300e3385114c561eec"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a7c3e886a0b8395c2045ab4f7e04481e1"><td class="memItemLeft" align="right" valign="top"><a id="a7c3e886a0b8395c2045ab4f7e04481e1"></a>
char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_storage.html#a7c3e886a0b8395c2045ab4f7e04481e1">fileName</a> [30]</td></tr>
<tr class="memdesc:a7c3e886a0b8395c2045ab4f7e04481e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">File name to use when saving data. <br /></td></tr>
<tr class="separator:a7c3e886a0b8395c2045ab4f7e04481e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14a7ad7e46c7cd5983344b81fed4265f"><td class="memItemLeft" align="right" valign="top"><a id="a14a7ad7e46c7cd5983344b81fed4265f"></a>
StaticJsonBuffer&lt; 200 &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_storage.html#a14a7ad7e46c7cd5983344b81fed4265f">jsonFileBuffer</a></td></tr>
<tr class="memdesc:a14a7ad7e46c7cd5983344b81fed4265f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocated space for holding JSON objects within. <br /></td></tr>
<tr class="separator:a14a7ad7e46c7cd5983344b81fed4265f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac503241aaa812f9b8ee36dd10cbd915a"><td class="memItemLeft" align="right" valign="top"><a id="ac503241aaa812f9b8ee36dd10cbd915a"></a>
JsonObject &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_storage.html#ac503241aaa812f9b8ee36dd10cbd915a">fileJSON</a> = jsonFileBuffer.createObject()</td></tr>
<tr class="memdesc:ac503241aaa812f9b8ee36dd10cbd915a"><td class="mdescLeft">&#160;</td><td class="mdescRight">JSON object that holds file information (size + name) <br /></td></tr>
<tr class="separator:ac503241aaa812f9b8ee36dd10cbd915a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Class for storing &amp; retrieving data on the logging device. </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a98b01eb20a64a4bf4127685147f7f6f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a98b01eb20a64a4bf4127685147f7f6f1">&#9670;&nbsp;</a></span>init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Storage::init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialisation function for storage module. </p>
<p>Responsible for starting the uSD library. </p>

<p class="reference">References <a class="el" href="_storage_8cpp.html#abe774366dbdfb2de4e34e4f07843db38">USD_CS</a>.</p>
<div class="fragment"><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;{</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  SD.begin(<a class="code" href="_storage_8cpp.html#abe774366dbdfb2de4e34e4f07843db38">USD_CS</a>);</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;}</div><div class="ttc" id="_storage_8cpp_html_abe774366dbdfb2de4e34e4f07843db38"><div class="ttname"><a href="_storage_8cpp.html#abe774366dbdfb2de4e34e4f07843db38">USD_CS</a></div><div class="ttdeci">#define USD_CS</div><div class="ttdoc">Chip select pin for MicroSD card (SPI) </div><div class="ttdef"><b>Definition:</b> Storage.cpp:22</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a044a17325b2917afca49aa19ddb488f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a044a17325b2917afca49aa19ddb488f6">&#9670;&nbsp;</a></span>saveToFile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Storage::saveToFile </td>
          <td>(</td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>data</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>newLine</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Saves a single line of data to a file. </p>
<p>Opens a handle to the current fileName. If the file exists data is appended, if not the file is created first.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>- Character array of data to save. </td></tr>
    <tr><td class="paramname">newLine</td><td>- Whether to add new line character at end of line. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>bool - Whether saving was a success. </dd></dl>

<p class="reference">References <a class="el" href="class_storage.html#a7c3e886a0b8395c2045ab4f7e04481e1">fileName</a>.</p>
<div class="fragment"><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;{</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="comment">/* Create handle to log file */</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  File logHandle = SD.open(<a class="code" href="class_storage.html#a7c3e886a0b8395c2045ab4f7e04481e1">fileName</a>, FILE_WRITE);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="comment">/* If handle exists print line to file */</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keywordflow">if</span> (logHandle)</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  {</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">/* Print line, option to add newline characters */</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    logHandle.print(data);</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordflow">if</span> (newLine)</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    {</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      logHandle.println();</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    }</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    logHandle.close();</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    result = <span class="keyword">true</span>;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  }</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;}</div><div class="ttc" id="class_storage_html_a7c3e886a0b8395c2045ab4f7e04481e1"><div class="ttname"><a href="class_storage.html#a7c3e886a0b8395c2045ab4f7e04481e1">Storage::fileName</a></div><div class="ttdeci">char fileName[30]</div><div class="ttdoc">File name to use when saving data. </div><div class="ttdef"><b>Definition:</b> Storage.h:16</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a571ce9630665d9407ffbaeff55c47b0a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a571ce9630665d9407ffbaeff55c47b0a">&#9670;&nbsp;</a></span>generateFileName()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Storage::generateFileName </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Generates a new filename to use for saving. </p>
<p>Searches through existing files using pattern PREFIX_ID.SUFFIX <br />
Existing files are skipped, once non-existant is found that is used.</p>
<dl class="section return"><dt>Returns</dt><dd>bool - Whether a valid file name was able to be found. </dd></dl>

<p class="reference">References <a class="el" href="class_storage.html#a7c3e886a0b8395c2045ab4f7e04481e1">fileName</a>, <a class="el" href="_storage_8cpp.html#a907e440e32d31fd828188004703e3178">LOG_EXTENSION</a>, <a class="el" href="_storage_8cpp.html#abbd544044b4167ca397bfb6e3073aa50">LOG_NAME</a>, and <a class="el" href="_storage_8cpp.html#a777ac288f17a847a5ce37bf9a89a0037">MAX_LOG_FILES</a>.</p>
<div class="fragment"><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;{</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keywordtype">int</span> i = 0;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="_storage_8cpp.html#a777ac288f17a847a5ce37bf9a89a0037">MAX_LOG_FILES</a>; i++)</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  {</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="comment">/* Clear name of log file */</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    memset(<a class="code" href="class_storage.html#a7c3e886a0b8395c2045ab4f7e04481e1">fileName</a>, 0, strlen(<a class="code" href="class_storage.html#a7c3e886a0b8395c2045ab4f7e04481e1">fileName</a>));</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="comment">/* Set the new log file name to: trip_XXXXX.json */</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    sprintf(<a class="code" href="class_storage.html#a7c3e886a0b8395c2045ab4f7e04481e1">fileName</a>, <span class="stringliteral">&quot;%s%d.%s&quot;</span>, <a class="code" href="_storage_8cpp.html#abbd544044b4167ca397bfb6e3073aa50">LOG_NAME</a>, i, <a class="code" href="_storage_8cpp.html#a907e440e32d31fd828188004703e3178">LOG_EXTENSION</a>);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keywordflow">if</span> (!SD.exists(<a class="code" href="class_storage.html#a7c3e886a0b8395c2045ab4f7e04481e1">fileName</a>))</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    {</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      <span class="comment">/* If a file doesn&#39;t exist */</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      result = <span class="keyword">true</span>;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    }</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  }</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;}</div><div class="ttc" id="_storage_8cpp_html_abbd544044b4167ca397bfb6e3073aa50"><div class="ttname"><a href="_storage_8cpp.html#abbd544044b4167ca397bfb6e3073aa50">LOG_NAME</a></div><div class="ttdeci">#define LOG_NAME</div><div class="ttdoc">The prefix of the name for logs. </div><div class="ttdef"><b>Definition:</b> Storage.cpp:26</div></div>
<div class="ttc" id="_storage_8cpp_html_a907e440e32d31fd828188004703e3178"><div class="ttname"><a href="_storage_8cpp.html#a907e440e32d31fd828188004703e3178">LOG_EXTENSION</a></div><div class="ttdeci">#define LOG_EXTENSION</div><div class="ttdoc">The suffix of the name for logs (file extension) </div><div class="ttdef"><b>Definition:</b> Storage.cpp:28</div></div>
<div class="ttc" id="class_storage_html_a7c3e886a0b8395c2045ab4f7e04481e1"><div class="ttname"><a href="class_storage.html#a7c3e886a0b8395c2045ab4f7e04481e1">Storage::fileName</a></div><div class="ttdeci">char fileName[30]</div><div class="ttdoc">File name to use when saving data. </div><div class="ttdef"><b>Definition:</b> Storage.h:16</div></div>
<div class="ttc" id="_storage_8cpp_html_a777ac288f17a847a5ce37bf9a89a0037"><div class="ttname"><a href="_storage_8cpp.html#a777ac288f17a847a5ce37bf9a89a0037">MAX_LOG_FILES</a></div><div class="ttdeci">#define MAX_LOG_FILES</div><div class="ttdoc">Maximum amount of log files that can be stored on the device. </div><div class="ttdef"><b>Definition:</b> Storage.cpp:24</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4831b2e8ecfa22da6971f5a8690cc4e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4831b2e8ecfa22da6971f5a8690cc4e3">&#9670;&nbsp;</a></span>loadTripNames()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Storage::loadTripNames </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Loads the information of all trips and sends them over bluetooth. </p>
<p>Searches directory for trips, then sends trip's name &amp; size over serial. </p>

<p class="reference">References <a class="el" href="_storage_8cpp.html#ad1e6e6f6fc813b305067b9e1b0777ea6">BT_SERIAL</a>, and <a class="el" href="class_storage.html#ac503241aaa812f9b8ee36dd10cbd915a">fileJSON</a>.</p>
<div class="fragment"><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;{</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="keywordtype">bool</span> filesRemaining = <span class="keyword">true</span>;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  File root = SD.open(<span class="stringliteral">&quot;/&quot;</span>);</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="comment">/* Try to open directory for logs */</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <span class="keywordflow">if</span> (root)</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  {</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="comment">/* Ensure starting from start of directory */</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    root.rewindDirectory();</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordflow">while</span> (filesRemaining == <span class="keyword">true</span>)</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    {</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      <span class="comment">/* Try open handle for next file */</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      File entry = root.openNextFile();</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <span class="keywordflow">if</span> (entry)</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      {</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="keywordflow">if</span> (entry.isDirectory() == <span class="keyword">false</span>)</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        {</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;          <span class="comment">/* Print out file name &amp; size */</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;          <a class="code" href="class_storage.html#ac503241aaa812f9b8ee36dd10cbd915a">fileJSON</a>[<span class="stringliteral">&quot;name&quot;</span>] = entry.name();</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;          <a class="code" href="class_storage.html#ac503241aaa812f9b8ee36dd10cbd915a">fileJSON</a>[<span class="stringliteral">&quot;size&quot;</span>] = entry.size();</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;          <a class="code" href="class_storage.html#ac503241aaa812f9b8ee36dd10cbd915a">fileJSON</a>.printTo(<a class="code" href="_storage_8cpp.html#ad1e6e6f6fc813b305067b9e1b0777ea6">BT_SERIAL</a>);</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;          <a class="code" href="_storage_8cpp.html#ad1e6e6f6fc813b305067b9e1b0777ea6">BT_SERIAL</a>.println();</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        }</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        entry.close();</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      }</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      {</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="comment">/* No more files remaining in directory */</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        filesRemaining = <span class="keyword">false</span>;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      }</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    }</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    root.close();</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  }</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;}</div><div class="ttc" id="_storage_8cpp_html_ad1e6e6f6fc813b305067b9e1b0777ea6"><div class="ttname"><a href="_storage_8cpp.html#ad1e6e6f6fc813b305067b9e1b0777ea6">BT_SERIAL</a></div><div class="ttdeci">#define BT_SERIAL</div><div class="ttdoc">Mapping for which HW-Serial port BT module is on. </div><div class="ttdef"><b>Definition:</b> Storage.cpp:20</div></div>
<div class="ttc" id="class_storage_html_ac503241aaa812f9b8ee36dd10cbd915a"><div class="ttname"><a href="class_storage.html#ac503241aaa812f9b8ee36dd10cbd915a">Storage::fileJSON</a></div><div class="ttdeci">JsonObject &amp; fileJSON</div><div class="ttdoc">JSON object that holds file information (size + name) </div><div class="ttdef"><b>Definition:</b> Storage.h:20</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af56ca8289ed925300e3385114c561eec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af56ca8289ed925300e3385114c561eec">&#9670;&nbsp;</a></span>loadSavedTrip()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Storage::loadSavedTrip </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Loads a saved trip and sends data to client via Serial. </p>
<p>Waits for the filename to be received via serial. Once file name is received, procedure attempts to open the file. If the file exists it then sends all bytes in the file via Serial. </p>

<p class="reference">References <a class="el" href="_storage_8cpp.html#ad1e6e6f6fc813b305067b9e1b0777ea6">BT_SERIAL</a>, and <a class="el" href="_storage_8cpp.html#a907e440e32d31fd828188004703e3178">LOG_EXTENSION</a>.</p>
<div class="fragment"><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;{</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keywordtype">bool</span> nameComplete = <span class="keyword">false</span>;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  String fileToOpen = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="keywordflow">while</span> (nameComplete == <span class="keyword">false</span>)</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  {</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">/* Keep reading input in serial until file name is found */</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="_storage_8cpp.html#ad1e6e6f6fc813b305067b9e1b0777ea6">BT_SERIAL</a>.available() &gt; 0)</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <span class="keywordtype">char</span> recvByte = <a class="code" href="_storage_8cpp.html#ad1e6e6f6fc813b305067b9e1b0777ea6">BT_SERIAL</a>.read();</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      fileToOpen += recvByte;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      <span class="comment">/* Wait until extension is found, then we know full file name */</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <span class="keywordflow">if</span> (fileToOpen.endsWith(<a class="code" href="_storage_8cpp.html#a907e440e32d31fd828188004703e3178">LOG_EXTENSION</a>))</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      {</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        nameComplete = <span class="keyword">true</span>;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      }</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    }</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  }</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="comment">/* Check if file exists */</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="keywordflow">if</span> (SD.exists(fileToOpen))</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  {</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="comment">/* Open file, then read out data byte by byte */</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    File handle = SD.open(fileToOpen);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordflow">if</span> (handle)</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    {</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      <span class="keywordflow">while</span> (handle.available())</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      {</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="keywordtype">char</span> readByte = handle.read();</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <a class="code" href="_storage_8cpp.html#ad1e6e6f6fc813b305067b9e1b0777ea6">BT_SERIAL</a>.write(readByte);</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      }</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      handle.close();</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  }</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;}</div><div class="ttc" id="_storage_8cpp_html_ad1e6e6f6fc813b305067b9e1b0777ea6"><div class="ttname"><a href="_storage_8cpp.html#ad1e6e6f6fc813b305067b9e1b0777ea6">BT_SERIAL</a></div><div class="ttdeci">#define BT_SERIAL</div><div class="ttdoc">Mapping for which HW-Serial port BT module is on. </div><div class="ttdef"><b>Definition:</b> Storage.cpp:20</div></div>
<div class="ttc" id="_storage_8cpp_html_a907e440e32d31fd828188004703e3178"><div class="ttname"><a href="_storage_8cpp.html#a907e440e32d31fd828188004703e3178">LOG_EXTENSION</a></div><div class="ttdeci">#define LOG_EXTENSION</div><div class="ttdoc">The suffix of the name for logs (file extension) </div><div class="ttdef"><b>Definition:</b> Storage.cpp:28</div></div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>logging-device/<a class="el" href="_storage_8h_source.html">Storage.h</a></li>
<li>logging-device/<a class="el" href="_storage_8cpp.html">Storage.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
